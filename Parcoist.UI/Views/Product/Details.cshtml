@using Parcoist.UI.Entities
@using Parcoist.Entity.Concrete
@model ProductDetailViewModel

@{
    ViewData["Title"] = "Details";
    Layout = "~/Views/Shared/_HomeLayout.cshtml";
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<div class="product">
    <div class="container">
        <div class="ctnt-bar cntnt">
            <div class="content-bar">
                <div class="single-page">
                    @*  <div class="product-head">
                        <a href="/">Home</a> <span>::</span>a
                        <span>@Model.Product.Name</span>
                    </div> *@

                    <!-- Updated Slider Section -->
                    <!-- Ana Slider Alanı -->
                    <div class="details-left-slider">
                        <div class="grid images_3_of_2">
                            <!-- Swiper Ana Slider -->
                            <div class="swiper product-main-slider">
                                <div class="swiper-wrapper">
                                    @foreach (var img in Model.ProductImages)
                                    {
                                        <div class="swiper-slide">
                                            <img src="@Url.Content("~/" + img.ImagePath)" class="img-fluid" />
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- Swiper Thumbnail Slider -->
                            <div class="swiper product-thumb-slider mt-2">
                                <div class="swiper-wrapper">
                                    @foreach (var img in Model.ProductImages)
                                    {
                                        <div class="swiper-slide">
                                            <img src="@Url.Content("~/" + img.ImagePath)" class="img-thumbnail" />
                                        </div>
                                    }
                                </div>
                            </div>



                        </div>
                    </div>

                    <div class="details-left-info">
                        <h3>@Model.Product.Name</h3>
                        <h4>Model No: @Model.Product.ModelNo</h4>
                        <p>
                            <label>₺</label> @Model.Product.DiscountedPrice
                            <span class="base-price">₺@Model.Product.BasePrice</span>
                        </p>

                        @if (Model.Product.Stock <= 10)
                        {
                            <p class="stock-warning">Stoklarla sınırlı! (@Model.Product.Stock adet kaldı)</p>
                        }
                        else
                        {
                            <p class="stock-info">Stok Miktarı: @Model.Product.Stock Adet</p>
                        }
                        @*  @if (Model.VariantCombinations != null && Model.VariantCombinations.Any())
                        {
                            <h5>Varyantlar</h5>
                            @foreach (var combination in Model.VariantCombinations)
                            {
                                <div class="variant-box" style="margin-bottom: 1rem;">
                                    <strong>Varyant:</strong> @combination.VariantKey <br />
                                    Stok: @combination.Stock <br />
                                    Fiyat Farkı: @combination.PriceAdjustment ₺ <br />
                                    <ul>
                                        @foreach (var val in combination.ProductVariantValues)
                                        {
                                            <li>@val.FeatureType.Value: @val.FeatureValue.Value</li>
                                        }
                                    </ul>
                                </div>
                            }
                        } *@
                        <div class="btn_form">
                            <a href="/Cart/Buy/@Model.Product.ProductID">SATIN AL</a>
                            @* <a href="/Cart/Add/@Model.Product.ProductID">ADD TO CART</a> *@
                        </div>
                        <div class="bike-type">
                            <p>MARKA :: <a href="#">@Model.Product.Brand.Name</a></p>
                        </div>
                        <h5>AÇIKLAMA ::</h5>
                        <p class="desc">@Model.Product.Description</p>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="product-comments mt-5">

        <h4 class="comment-title">Yorum Ekle</h4>

        <form id="commentForm" class="comment-form d-flex align-items-start">
            @*  <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div> *@
            <div class="form-group flex-grow-1 ms-3">
                <textarea name="CommentText" class="form-control" rows="3" placeholder="Yorumunuzu yazın..." required></textarea>
                <div class="d-flex justify-content-end mt-2">
                    <button type="submit" class="btn btn-primary">Gönder</button>
                </div>
            </div>
            <input type="hidden" name="ProductID" value="@Model.Product.ProductID" />
        </form>

        <h4 class="comment-title mt-5">Ürün Yorumları</h4>

        @if (Model.ProductComments != null && Model.ProductComments.Any())
        {
            <div class="swiper comment-swiper">
                <div class="swiper-wrapper">
                    @foreach (var comment in Model.ProductComments)
                    {
                        if (comment.IsActive)
                        {
                            <div class="swiper-slide">
                                <div class="comment-card">
                                    <div class="comment-header">
                                        <div class="user-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="user-info">
                                            <strong>@comment.UserName</strong>
                                            <small>@comment.CreatedAt.ToString("dd MMM yyyy")</small>
                                        </div>
                                    </div>
                                    <div class="comment-body">
                                        <p>@comment.CommentText</p>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                </div>
            </div>
        }
        else
        {
            <p class="no-comments">Henüz bu ürün için yorum yapılmamış.</p>
        }


    </div>


</div>

<style>
    .stock-warning {
        margin-top: 5px;
    }

    .stock-info {
        font-weight: normal;
        margin-top: 5px;
    }

    .base-price {
        text-decoration: line-through; /* üstü çizili */
        color: #888; /* hafif gri */
        margin-left: 10px; /* indirimli fiyattan biraz boşluk */
        font-weight: normal;
    }

    .comment-swiper {
        padding: 20px 0;
    }

        .comment-swiper .swiper-slide {
            width: 300px; /* Genişliği ayarlayabilirsin */
        }

    .comment-card {
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        transition: transform 0.2s ease;
        height: 100%;
    }

        .comment-card:hover {
            transform: translateY(-3px);
        }

</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $('#commentForm').submit(function (e) {
            e.preventDefault(); // Sayfanın reload olmasını engelle

            var formData = {
                ProductID: $('input[name="ProductID"]').val(),
                CommentText: $('textarea[name="CommentText"]').val()
            };

            $.ajax({
                url: '/Product/AddComment',
                type: 'POST',
                data: formData,
                success: function () {
                    // Başarılıysa sayfayı yeniden yükle
                    location.reload();
                },
                error: function () {
                    alert('Yorum eklenirken bir hata oluştu.');
                }
            });

            // Gönder butonunu 5 dk boyunca pasif yap
            var btn = $(this).find('button[type="submit"]');
            btn.prop('disabled', true);
            setTimeout(function () {
                btn.prop('disabled', false);
            }, 300000); // 300000 ms = 5 dakika
        });
    });
</script>






<!-- Font Awesome (kullanılıyor) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />

<!-- jQuery (gerekli) -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

<!-- Swiper Ayarları -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const thumbSwiper = new Swiper('.product-thumb-slider', {
            spaceBetween: 10,
            slidesPerView: 4,
            freeMode: true,
            watchSlidesProgress: true,
        });

        const mainSwiper = new Swiper('.product-main-slider', {
            spaceBetween: 10,
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            thumbs: {
                swiper: thumbSwiper,
            },
        });
    });
</script>
<style>
    /* Modern Yorum Alanı */
    .comment-form {
        gap: 15px;
        margin-bottom: 30px;
    }

        .comment-form .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #e2e6ea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: #495057;
            flex-shrink: 0;
        }

        .comment-form textarea {
            border-radius: 20px;
            padding: 12px 20px;
            resize: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid #ccc;
            width: 100%;
            transition: all 0.3s ease;
        }

            .comment-form textarea:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 2px 10px rgba(0,123,255,0.2);
            }

        .comment-form button {
            border-radius: 20px;
            padding: 6px 20px;
        }

    .comment-title {
        font-size: 1.6rem;
        font-weight: 600;
        margin-bottom: 20px;
        border-bottom: 2px solid #007bff;
        display: inline-block;
        padding-bottom: 5px;
    }

    /* Mevcut yorum kartları zaten modern */
    .comment-card {
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

        .comment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
        }

    /*  .product {
            position: relative;
            background: url('/assest/images/sabit/resimgif.gif') no-repeat center center fixed;
            background-size: cover;
        } */



    .product-main-slider {
        width: 100%;
        height: 400px;
        margin-bottom: 10px;
    }

        .product-main-slider .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

    .product-thumb-slider {
        height: 100px;
    }

        .product-thumb-slider .swiper-slide {
            width: 100px;
            height: 100px;
            opacity: 0.4;
            cursor: pointer;
        }

        .product-thumb-slider .swiper-slide-thumb-active {
            opacity: 1;
            border: 2px solid #333;
        }

    /* Yorum alanı */
    .product-comments {
        max-width: 1140px; /* veya üst yapıya uygunsa 1200px, 960px olabilir */
        margin: 60px auto 0 auto; /* ortalama ve yukarı boşluk */
        padding: 30px;
        border-top: 1px solid #ddd;
        border-radius: 12px;
    }


    .comment-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
        font-weight: bold;
        border-bottom: 2px solid #333;
        display: inline-block;
        padding-bottom: 5px;
    }

    .comment-list {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .comment-card {
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        transition: transform 0.2s ease;
    }

        .comment-card:hover {
            transform: translateY(-3px);
        }

    .comment-header {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .user-avatar {
        width: 45px;
        height: 45px;
        background-color: #e2e6ea;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: #495057;
        margin-right: 15px;
    }

    .user-info strong {
        display: block;
        font-weight: 600;
    }

    .user-info small {
        color: #6c757d;
        font-size: 0.85rem;
    }

    .comment-body p {
        margin: 0;
        line-height: 1.6;
        color: #333;
    }

    .no-comments {
        font-style: italic;
        color: #777;
        margin-top: 10px;
    }

</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Ürün ana ve thumb slider (varsa)
        const thumbSwiper = new Swiper('.product-thumb-slider', {
            spaceBetween: 10,
            slidesPerView: 4,
            freeMode: true,
            watchSlidesProgress: true,
        });

        const mainSwiper = new Swiper('.product-main-slider', {
            spaceBetween: 10,
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            thumbs: {
                swiper: thumbSwiper,
            },
        });

        // Yorum slider (otomatik ve elle sürüklenebilir)
        const commentSwiper = new Swiper('.comment-swiper', {
            slidesPerView: 3,
            spaceBetween: 20,
            loop: true, // sonsuz döngü
            autoplay: {
                delay: 3000, // her 3 saniyede bir kayar
                disableOnInteraction: false, // kullanıcı sürüklerse autoplay devam eder
            },
            breakpoints: {
                0: { slidesPerView: 1 },
                576: { slidesPerView: 1 },
                768: { slidesPerView: 2 },
                992: { slidesPerView: 3 }
            },
            grabCursor: true, // elle sürükleme göstergesi
        });
    });


</script>